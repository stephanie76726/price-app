<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>報價助手</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        input[type=number]::-webkit-inner-spin-button, 
        input[type=number]::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }
        body { -webkit-tap-highlight-color: transparent; background-color: #f8fafc; }
        * { touch-action: manipulation; }
    </style>
</head>
<body class="text-slate-800">
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useEffect } = React;
        const IconCalculator = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="16" height="20" x="4" y="2" rx="2"/><line x1="8" x2="16" y1="6" y2="6"/><line x1="16" x2="16" y1="14" y2="18"/><path d="M16 10h.01"/><path d="M12 10h.01"/><path d="M8 10h.01"/><path d="M12 14h.01"/><path d="M8 14h.01"/><path d="M12 18h.01"/><path d="M8 18h.01"/></svg>;
        const IconSettings = () => <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.38a2 2 0 0 0-.73-2.73l-.15-.1a2 2 0 0 1-1-1.72v-.51a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></svg>;
        const IconRefresh = () => <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/><path d="M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16"/><path d="M16 16h5v5"/></svg>;
        const IconDollar = () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="12" x2="12" y1="2" y2="22"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg>;
        const IconTrending = () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="22 7 13.5 15.5 8.5 10.5 2 17"/><polyline points="16 7 22 7 22 13"/></svg>;
        const IconArrow = () => <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m16 3 4 4-4 4"/><path d="M20 7H4"/><path d="m8 21-4-4 4-4"/><path d="M4 17h16"/></svg>;
        const IconInfo = () => <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><path d="M12 16v-4"/><path d="M12 8h.01"/></svg>;
        const IconCalcSmall = () => <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="16" height="20" x="4" y="2" rx="2"/><line x1="8" x2="16" y1="6" y2="6"/><line x1="16" x2="16" y1="14" y2="18"/><path d="M16 10h.01"/><path d="M12 10h.01"/><path d="M8 10h.01"/><path d="M12 14h.01"/><path d="M8 14h.01"/><path d="M12 18h.01"/><path d="M8 18h.01"/></svg>;
        const IconRepeat = () => <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m17 2 4 4-4 4"/><path d="M3 11v-1a4 4 0 0 1 4-4h14"/><path d="m7 22-4-4 4-4"/><path d="M21 13v1a4 4 0 0 1-4 4H3"/></svg>;

        const Card = ({ children, className = "" }) => (
            <div className={`bg-white rounded-xl shadow-sm border border-slate-200 ${className}`}>
                {children}
            </div>
        );
        const InputGroup = ({ label, value, onChange, prefix = "$", type = "number", step = "0.01", placeholder = "0.00" }) => (
            <div className="flex flex-col gap-1.5">
                <label className="text-xs font-bold text-slate-500 uppercase tracking-wider">{label}</label>
                <div className="relative">
                    <span className="absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 font-bold">{prefix}</span>
                    <input type={type} step={step} value={value} onChange={(e) => onChange(e.target.value)} className="w-full pl-8 pr-3 py-2.5 bg-slate-50 border border-slate-200 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none transition-all font-bold text-slate-700 text-lg" placeholder={placeholder} />
                </div>
            </div>
        );
        const ResultRow = ({ label, twd, usd, rmb, highlight = false }) => (
            <div className={`p-4 rounded-lg border ${highlight ? 'bg-indigo-50 border-indigo-100' : 'bg-white border-slate-100'}`}>
                <div className="flex justify-between items-center mb-3">
                    <span className={`font-bold ${highlight ? 'text-indigo-700' : 'text-slate-700'}`}>{label}</span>
                    {highlight && <span className="text-[10px] bg-indigo-200 text-indigo-800 px-2 py-0.5 rounded-full font-bold">推薦</span>}
                </div>
                <div className="grid grid-cols-3 gap-3 text-sm">
                    <div>
                        <div className="text-[10px] text-slate-400 font-medium mb-0.5">美金報價</div>
                        <div className="font-mono font-bold text-slate-800 text-base">{usd}</div>
                    </div>
                    <div>
                        <div className="text-[10px] text-slate-400 font-medium mb-0.5">人民幣報價</div>
                        <div className="font-mono font-medium text-slate-600 text-base">{rmb}</div>
                    </div>
                    <div>
                        <div className="text-[10px] text-slate-400 font-medium mb-0.5">台幣報價(+5%)</div>
                        <div className="font-mono font-medium text-slate-600 text-base">{twd}</div>
                    </div>
                </div>
            </div>
        );

        function App() {
            const [rateUSD, setRateUSD] = useState(32.60);
            const [rateRMB, setRateRMB] = useState(4.50);
            const [crossRate, setCrossRate] = useState((32.60 / 4.50).toFixed(3));
            const [showSettings, setShowSettings] = useState(false);
            const [costTWD, setCostTWD] = useState('');
            const [costUSD, setCostUSD] = useState('');
            const [costRMB, setCostRMB] = useState('');
            const [rmbTaxType, setRmbTaxType] = useState('untaxed'); 
            const [customPrice, setCustomPrice] = useState('');
            const [customCurrency, setCustomCurrency] = useState('USD');
            const [totalCostTWD, setTotalCostTWD] = useState(0);
            const [calculations, setCalculations] = useState(null);
            const fmt = (num) => num ? new Intl.NumberFormat('zh-TW', { maximumFractionDigits: 0 }).format(num) : '-';

            useEffect(() => {
                if (rateRMB > 0) {
                    const calculatedCross = rateUSD / rateRMB;
                    if (Math.abs(parseFloat(crossRate) - calculatedCross) > 0.001) {
                        setCrossRate(calculatedCross.toFixed(3));
                    }
                }
            }, [rateUSD, rateRMB]);

            const handleCrossRateChange = (val) => {
                setCrossRate(val);
                const newCross = parseFloat(val);
                if (newCross > 0 && rateUSD > 0) {
                    const newRateRMB = rateUSD / newCross;
                    setRateRMB(newRateRMB);
                }
            };
            useEffect(() => {
                const cTWD = parseFloat(costTWD) || 0;
                const cUSD = (parseFloat(costUSD) || 0) * rateUSD;
                let cRMB_Input = parseFloat(costRMB) || 0;
                let effectiveRMB = rmbTaxType === 'taxed' ? cRMB_Input / 1.13 : cRMB_Input;
                const cRMB = effectiveRMB * rateRMB;
                const total = cTWD + cUSD + cRMB;
                setTotalCostTWD(total);

                if (total > 0) {
                    const calcPrice = (marginPercent) => {
                        const basePriceTWD = total / (1 - marginPercent);
                        return {
                            twd: Math.ceil(basePriceTWD * 1.05),
                            usd: (basePriceTWD / rateUSD).toFixed(2),
                            rmb: (basePriceTWD / rateRMB).toFixed(2)
                        };
                    };
                    setCalculations({
                        low: calcPrice(0.33),
                        mid: calcPrice(0.33 * 1.5),
                        high: calcPrice(0.33 * 2)
                    });
                } else {
                    setCalculations(null);
                }
            }, [costTWD, costUSD, costRMB, rmbTaxType, rateUSD, rateRMB]);

            const getCustomMarginResult = () => {
                if (!customPrice || !totalCostTWD) return null;
                const price = parseFloat(customPrice);
                if (isNaN(price) || price <= 0) return null;
                let baseRevenueTWD = 0;
                if (customCurrency === 'TWD') baseRevenueTWD = price / 1.05;
                else if (customCurrency === 'USD') baseRevenueTWD = price * rateUSD;
                else if (customCurrency === 'RMB') baseRevenueTWD = price * rateRMB;
                const profit = baseRevenueTWD - totalCostTWD;
                const margin = (profit / baseRevenueTWD) * 100;
                return { margin, profit, baseRevenueTWD };
            };

            const customResult = getCustomMarginResult();
            const handleReset = () => { setCostTWD(''); setCostUSD(''); setCostRMB(''); setRmbTaxType('untaxed'); setCustomPrice(''); };

            return (
                <div className="min-h-screen p-4 pb-20 max-w-lg mx-auto">
                    <div className="space-y-6">
                        <div className="flex justify-between items-center pt-2">
                            <div className="flex items-center gap-2.5">
                                <div className="bg-indigo-600 p-2.5 rounded-xl text-white shadow-lg shadow-indigo-200"><IconCalculator /></div>
                                <h1 className="text-2xl font-black text-slate-800 tracking-tight">報價助手</h1>
                            </div>
                            <button onClick={() => setShowSettings(!showSettings)} className={`flex items-center gap-1.5 px-4 py-2 rounded-full text-sm font-bold transition-all ${showSettings ? 'bg-indigo-100 text-indigo-700' : 'bg-white text-slate-500 shadow-sm border border-slate-100'}`}>
                                <IconSettings /> 匯率
                            </button>
                        </div>
                        {showSettings && (
                            <div className="bg-white p-5 rounded-2xl border border-indigo-100 shadow-lg space-y-4 animate-fade-in">
                                <div className="flex items-center gap-2 text-indigo-600 border-b border-indigo-50 pb-2"><IconArrow /><h3 className="text-xs font-bold uppercase tracking-wider">手動匯率設定</h3></div>
                                <div className="grid grid-cols-2 gap-4"><InputGroup label="美金 (USD)" value={rateUSD} onChange={setRateUSD} prefix="1:" /><InputGroup label="人民幣 (RMB)" value={rateRMB} onChange={setRateRMB} prefix="1:" /></div>
                                <div className="bg-indigo-50/50 p-3 rounded-xl border border-indigo-100 mt-2"><div className="flex items-center gap-2 mb-2 text-indigo-700"><IconRepeat /><span className="text-[10px] font-bold uppercase tracking-wider">交叉匯率 (可輸入)</span></div><div className="flex items-center gap-3"><div className="text-sm font-bold text-slate-500 whitespace-nowrap">1 USD ≈</div><div className="relative w-full"><input type="number" value={crossRate} onChange={(e) => handleCrossRateChange(e.target.value)} step="0.001" className="w-full px-3 py-2 bg-white border border-indigo-200 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none text-indigo-700 font-bold font-mono text-lg" /><span className="absolute right-3 top-1/2 -translate-y-1/2 text-xs text-slate-400 font-bold">RMB</span></div></div><p className="text-[10px] text-slate-400 mt-2 text-center">*修改交叉匯率將自動調整 RMB 匯率</p></div>
                            </div>
                        )}
                        <Card className="p-5 space-y-4 shadow-md">
                            <div className="flex justify-between items-center mb-1"><h2 className="font-bold text-lg flex items-center gap-2 text-slate-800"><IconDollar /> 成本結構</h2><button onClick={handleReset} className="text-xs font-bold text-slate-400 flex items-center gap-1 bg-slate-100 px-2 py-1 rounded-md"><IconRefresh /> 重置</button></div>
                            <InputGroup label="台幣成本 (TWD)" value={costTWD} onChange={setCostTWD} prefix="NT$" /><InputGroup label="美金成本 (USD)" value={costUSD} onChange={setCostUSD} prefix="US$" />
                            <div className="space-y-2"><div className="flex justify-between items-end"><label className="text-xs font-bold text-slate-500 uppercase tracking-wider">人民幣成本 (RMB)</label><div className="flex bg-slate-100 p-1 rounded-lg"><button onClick={() => setRmbTaxType('untaxed')} className={`px-3 py-1 text-[10px] rounded-md font-bold transition-all ${rmbTaxType === 'untaxed' ? 'bg-white shadow text-slate-800' : 'text-slate-400'}`}>未稅</button><button onClick={() => setRmbTaxType('taxed')} className={`px-3 py-1 text-[10px] rounded-md font-bold transition-all ${rmbTaxType === 'taxed' ? 'bg-white shadow text-emerald-600' : 'text-slate-400'}`}>含稅</button></div></div><div className="relative"><span className="absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 font-bold">¥</span><input type="number" value={costRMB} onChange={(e) => setCostRMB(e.target.value)} className="w-full pl-8 pr-3 py-2.5 bg-slate-50 border border-slate-200 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none font-bold text-slate-700 text-lg" placeholder="0.00" /></div>{rmbTaxType === 'taxed' && costRMB > 0 && <p className="text-[10px] text-emerald-600 text-right font-medium">*實際成本 (÷1.13): ¥{parseFloat(costRMB / 1.13).toFixed(2)}</p>}</div>
                        </Card>
                        <div className="space-y-4 pb-10">
                            <div className="flex justify-between items-center px-2 bg-slate-800 text-white p-4 rounded-xl shadow-lg"><span className="font-bold text-sm opacity-80">總成本 (USD)</span><span className="text-2xl font-mono font-bold tracking-tight">$ {totalCostTWD > 0 ? (totalCostTWD / rateUSD).toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 }) : '0.00'}</span></div>
                            {totalCostTWD > 0 && (
                                <div className="space-y-5">
                                    <Card className="p-4 border-2 border-emerald-100 bg-emerald-50/30">
                                        <div className="flex items-center gap-2 text-emerald-700 mb-3"><IconCalcSmall /><span className="text-xs font-bold uppercase tracking-wider">自訂報價試算 (反算毛利)</span></div>
                                        <div className="flex gap-2 mb-3"><div className="flex-1 relative"><input type="number" value={customPrice} onChange={(e) => setCustomPrice(e.target.value)} className="w-full px-3 py-3 border border-emerald-200 rounded-lg focus:ring-2 focus:ring-emerald-500 outline-none text-slate-800 font-bold text-lg" placeholder="輸入欲報價格" /></div><select value={customCurrency} onChange={(e) => setCustomCurrency(e.target.value)} className="px-2 py-2 border border-emerald-200 rounded-lg bg-white text-slate-700 font-bold text-sm outline-none focus:ring-2 focus:ring-emerald-500"><option value="USD">USD</option><option value="RMB">RMB</option><option value="TWD">TWD</option></select></div>
                                        {customResult ? (<div className="bg-white rounded-lg p-3 border border-emerald-100 grid grid-cols-2 gap-4 shadow-sm"><div><div className="text-[10px] text-slate-400 mb-0.5 font-bold">預估毛利率</div><div className={`font-black text-xl ${customResult.margin < 0 ? 'text-red-500' : 'text-emerald-600'}`}>{customResult.margin.toFixed(2)}%</div></div><div><div className="text-[10px] text-slate-400 mb-0.5 font-bold">預估淨利 (TWD)</div><div className={`font-mono font-bold text-sm ${customResult.profit < 0 ? 'text-red-500' : 'text-slate-700'}`}>NT$ {new Intl.NumberFormat('zh-TW', { maximumFractionDigits: 0 }).format(customResult.profit)}</div></div></div>) : <p className="text-[10px] text-slate-400 text-center py-2 font-medium">輸入價格以計算實際毛利</p>}
                                    </Card>
                                    <div className="space-y-3"><div className="flex items-center gap-2 text-indigo-600 mb-1 px-1"><IconTrending /><span className="text-xs font-bold uppercase tracking-wider">建議報價單</span></div><ResultRow label="標準報價 (33%)" twd={`NT$ ${fmt(calculations.low.twd)}`} usd={`$ ${calculations.low.usd}`} rmb={`¥ ${calculations.low.rmb}`} /><ResultRow label="進階報價 (49.5%)" twd={`NT$ ${fmt(calculations.mid.twd)}`} usd={`$ ${calculations.mid.usd}`} rmb={`¥ ${calculations.mid.rmb}`} highlight={true} /><ResultRow label="高利潤報價 (66%)" twd={`NT$ ${fmt(calculations.high.twd)}`} usd={`$ ${calculations.high.usd}`} rmb={`¥ ${calculations.high.rmb}`} /></div>
                                    <div className="flex gap-2 p-3 bg-blue-50 text-blue-700 text-[10px] rounded-lg font-medium"><IconInfo /><p>台幣報價含5%稅，總成本顯示為USD。</p></div>
                                </div>
                            )}
                        </div>
                    </div>
                </div>
            );
        }
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>