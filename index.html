<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>報價助手</title>
    <meta name="description" content="專業多幣別利潤報價計算機">
    <!-- 引入 Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- 引入 React 和 ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <!-- 引入 Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <style>
        input[type=number]::-webkit-inner-spin-button, 
        input[type=number]::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }
        body { -webkit-tap-highlight-color: transparent; background-color: #f8fafc; }
        * { touch-action: manipulation; }
        .custom-radio:checked + div { border-color: #4f46e5; background-color: #eef2ff; color: #4338ca; }
        .custom-radio:checked + div .radio-dot { border-color: #4f46e5; border-width: 5px; }
        .mode-btn { transition: all 0.2s ease; }
        .animate-fade-in { animation: fadeIn 0.3s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="text-slate-800">

    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // --- SVG 圖示 ---
        const IconCalculator = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="16" height="20" x="4" y="2" rx="2"/><line x1="8" x2="16" y1="6" y2="6"/><line x1="16" x2="16" y1="14" y2="18"/><path d="M16 10h.01"/><path d="M12 10h.01"/><path d="M8 10h.01"/><path d="M12 14h.01"/><path d="M8 14h.01"/><path d="M12 18h.01"/><path d="M8 18h.01"/></svg>;
        const IconSettings = () => <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.38a2 2 0 0 0-.73-2.73l-.15-.1a2 2 0 0 1-1-1.72v-.51a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></svg>;
        const IconRefresh = () => <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/><path d="M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16"/><path d="M16 16h5v5"/></svg>;
        const IconDollar = () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="12" x2="12" y1="2" y2="22"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg>;
        const IconTrending = () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="22 7 13.5 15.5 8.5 10.5 2 17"/><polyline points="16 7 22 7 22 13"/></svg>;
        const IconArrow = () => <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m16 3 4 4-4 4"/><path d="M20 7H4"/><path d="m8 21-4-4 4-4"/><path d="M4 17h16"/></svg>;
        const IconInfo = () => <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><path d="M12 16v-4"/><path d="M12 8h.01"/></svg>;
        const IconCalcSmall = () => <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="16" height="20" x="4" y="2" rx="2"/><line x1="8" x2="16" y1="6" y2="6"/><line x1="16" x2="16" y1="14" y2="18"/><path d="M16 10h.01"/><path d="M12 10h.01"/><path d="M8 10h.01"/><path d="M12 14h.01"/><path d="M8 14h.01"/><path d="M12 18h.01"/><path d="M8 18h.01"/></svg>;
        const IconFactory = () => <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M2 20a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V8l-7 5V8l-7 5V4a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2Z"/><path d="M17 18h1"/><path d="M12 18h1"/><path d="M7 18h1"/></svg>;

        const Card = ({ children, className = "" }) => (
            <div className={`bg-white rounded-xl shadow-sm border border-slate-200 ${className}`}>
                {children}
            </div>
        );

        const InputGroup = ({ label, value, onChange, prefix = "$", type = "number", step = "0.01", placeholder = "0.00", className="" }) => (
            <div className={`flex flex-col gap-1.5 ${className}`}>
                <label className="text-xs font-bold text-slate-500 uppercase tracking-wider">{label}</label>
                <div className="relative">
                    <span className="absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 font-bold">{prefix}</span>
                    <input type={type} step={step} value={value} onChange={(e) => onChange(e.target.value)} className="w-full pl-14 pr-3 py-2.5 bg-white border border-slate-200 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none transition-all font-bold text-slate-700 text-lg shadow-sm" placeholder={placeholder} />
                </div>
            </div>
        );

        const ResultRow = ({ label, twd, usd, rmb, highlight = false }) => (
            <div className={`p-4 rounded-lg border ${highlight ? 'bg-indigo-50 border-indigo-100' : 'bg-white border-slate-100'}`}>
                <div className="flex justify-between items-center mb-3">
                    <span className={`font-bold ${highlight ? 'text-indigo-700' : 'text-slate-700'}`}>{label}</span>
                    {highlight && <span className="text-[10px] bg-indigo-200 text-indigo-800 px-2 py-0.5 rounded-full font-bold">推薦</span>}
                </div>
                <div className="grid grid-cols-3 gap-3 text-sm">
                    <div>
                        <div className="text-[10px] text-slate-400 font-medium mb-0.5">美金報價</div>
                        <div className="font-mono font-bold text-slate-800 text-base">{usd}</div>
                    </div>
                    <div>
                        <div className="text-[10px] text-slate-400 font-medium mb-0.5">人民幣報價</div>
                        <div className="font-mono font-medium text-slate-600 text-base">{rmb}</div>
                    </div>
                    <div>
                        <div className="text-[10px] text-slate-400 font-medium mb-0.5">台幣報價(+5%)</div>
                        <div className="font-mono font-medium text-slate-600 text-base">{twd}</div>
                    </div>
                </div>
            </div>
        );

        function App() {
            // 匯率設定 (按圖輸入：台北帳區 31.10 / 4.44 | F6 帳區固定 6.89)
            const [rateUSD, setRateUSD] = useState(31.10); 
            const [rateRMB, setRateRMB] = useState(4.44);  
            const [crossRate, setCrossRate] = useState(6.89); 
            const [showSettings, setShowSettings] = useState(false);

            const [productType, setProductType] = useState('other');
            const [costCalcMode, setCostCalcMode] = useState('direct');

            // 基礎成本輸入
            const [costTWD, setCostTWD] = useState('');
            const [costUSD, setCostUSD] = useState('');
            const [costRMB, setCostRMB] = useState('');
            const [rmbTaxType, setRmbTaxType] = useState('untaxed'); 

            // 詳細計算模式輸入
            const [detailMaterial, setDetailMaterial] = useState('');
            const [detailTime, setDetailTime] = useState('');
            const [detailRate, setDetailRate] = useState('');

            const [customPrice, setCustomPrice] = useState('');
            const [customCurrency, setCustomCurrency] = useState('USD');

            const [totalCostTWD, setTotalCostTWD] = useState(0);
            const [calculations, setCalculations] = useState(null);

            const fmt = (num) => num ? new Intl.NumberFormat('zh-TW', { maximumFractionDigits: 0 }).format(num) : '-';

            // 檢查詳細模式欄位是否填滿
            const isDetailFilled = detailMaterial !== '' && detailTime !== '' && detailRate !== '';

            useEffect(() => {
                if (productType === 'lan') setCostCalcMode('direct');
            }, [productType]);

            // 計算核心
            useEffect(() => {
                let currentTotalTWD = 0;

                if (costCalcMode === 'direct') {
                    // 直接輸入順序：TWD -> USD -> RMB
                    const cTWD = parseFloat(costTWD) || 0;
                    const cUSD = (parseFloat(costUSD) || 0) * rateUSD;
                    const rawRMB = parseFloat(costRMB) || 0;
                    const effectiveRMB = rmbTaxType === 'taxed' ? rawRMB / 1.13 : rawRMB;
                    const cRMB = effectiveRMB * rateRMB; // 使用 TWD/RMB 直接匯率
                    currentTotalTWD = cTWD + cUSD + cRMB;
                } else {
                    if (isDetailFilled) {
                        const mat = parseFloat(detailMaterial) || 0;
                        const time = parseFloat(detailTime) || 0;
                        const laborRate = parseFloat(detailRate) || 0;
                        const rawRMB = mat + (time / 3600 * laborRate);
                        const effectiveRMB = rmbTaxType === 'taxed' ? rawRMB / 1.13 : rawRMB;
                        // 詳細模式轉換為台幣使用台北帳區 4.44
                        currentTotalTWD = effectiveRMB * rateRMB;
                    } else {
                        currentTotalTWD = 0;
                    }
                }

                setTotalCostTWD(currentTotalTWD);

                if (currentTotalTWD > 0) {
                    const baseMargin = productType === 'lan' ? 0.20 : 0.33;
                    const calcPrice = (marginPercent) => {
                        const basePriceTWD = currentTotalTWD / (1 - marginPercent);
                        const priceUSD = basePriceTWD / rateUSD;
                        return {
                            twd: Math.ceil(basePriceTWD * 1.05),
                            usd: priceUSD.toFixed(2),
                            // 人民幣報價使用 F6 交叉匯率 6.89
                            rmb: (priceUSD * crossRate).toFixed(2),
                            label: `毛利 ${(marginPercent * 100).toFixed(1)}%`
                        };
                    };

                    setCalculations({
                        low: calcPrice(baseMargin),
                        mid: calcPrice(baseMargin * 1.5),
                        high: calcPrice(baseMargin * 2)
                    });
                } else {
                    setCalculations(null);
                }
            }, [costTWD, costUSD, costRMB, rmbTaxType, rateUSD, rateRMB, crossRate, productType, costCalcMode, detailMaterial, detailTime, detailRate, isDetailFilled]); 

            const getCustomMarginResult = () => {
                if (!customPrice || totalCostTWD <= 0) return null;
                const price = parseFloat(customPrice);
                if (isNaN(price) || price <= 0) return null;

                let baseRevenueTWD = 0;
                if (customCurrency === 'TWD') baseRevenueTWD = price / 1.05;
                else if (customCurrency === 'USD') baseRevenueTWD = price * rateUSD;
                else if (customCurrency === 'RMB') baseRevenueTWD = price * rateRMB;

                const profit = baseRevenueTWD - totalCostTWD;
                const margin = (profit / baseRevenueTWD) * 100;

                return { margin, profit, baseRevenueTWD };
            };

            const customResult = getCustomMarginResult();
            const handleReset = () => { 
                setCostTWD(''); setCostUSD(''); setCostRMB(''); 
                setDetailMaterial(''); setDetailTime(''); setDetailRate('');
                setRmbTaxType('untaxed'); setCustomPrice(''); 
            };

            // 詳細模式 RMB 換算顯示 (使用 F6 交叉匯率與台北帳區匯率)
            const calcDetailRMB = isDetailFilled ? (parseFloat(detailMaterial)||0) + ((parseFloat(detailTime)||0)/3600 * (parseFloat(detailRate)||0)) : 0;
            const calcDetailUSD = calcDetailRMB / crossRate; // 使用 F6 交叉匯率
            const calcDetailTWD = calcDetailRMB * rateRMB;   // 使用台北帳區

            return (
                <div className="min-h-screen p-4 pb-20 max-w-lg mx-auto">
                    <div className="space-y-6">
                        {/* Header */}
                        <div className="flex justify-between items-center pt-2">
                            <div className="flex items-center gap-2.5">
                                <div className="bg-indigo-600 p-2.5 rounded-xl text-white shadow-lg shadow-indigo-200"><IconCalculator /></div>
                                <h1 className="text-2xl font-black text-slate-800 tracking-tight">報價助手</h1>
                            </div>
                            <button onClick={() => setShowSettings(!showSettings)} className={`flex items-center gap-1.5 px-4 py-2 rounded-full text-sm font-bold transition-all ${showSettings ? 'bg-indigo-100 text-indigo-700' : 'bg-white text-slate-500 shadow-sm border border-slate-100'}`}>
                                <IconSettings /> 匯率
                            </button>
                        </div>

                        {/* Settings - 獨立欄位，無連動 */}
                        {showSettings && (
                            <div className="bg-white p-5 rounded-2xl border border-indigo-100 shadow-lg space-y-4 animate-fade-in">
                                <div className="flex items-center gap-2 text-indigo-600 border-b border-indigo-50 pb-2">
                                    <IconArrow />
                                    <h3 className="text-xs font-bold uppercase tracking-wider">業務匯率設定 (按圖輸入)</h3>
                                </div>
                                <div className="grid grid-cols-2 gap-4">
                                    <InputGroup label="美金 (USD/TWD)" value={rateUSD} onChange={setRateUSD} prefix="NT$" />
                                    <InputGroup label="人民幣 (RMB/TWD)" value={rateRMB} onChange={setRateRMB} prefix="NT$" />
                                </div>
                                <div className="bg-indigo-50/50 p-4 rounded-xl border border-indigo-100 mt-2">
                                    <InputGroup label="交叉匯率 (USD/RMB)" value={crossRate} onChange={setCrossRate} prefix="¥" />
                                    <p className="text-[10px] text-indigo-400 mt-2 font-bold italic">* 已移除自動計算，請手動依財務報表輸入 (如 F6: 6.89)</p>
                                </div>
                            </div>
                        )}

                        {/* Costs */}
                        <Card className="p-5 space-y-4 shadow-md">
                            <div className="flex gap-4 pb-2 border-b border-slate-100">
                                <label className="flex-1 cursor-pointer">
                                    <input type="radio" checked={productType === 'other'} onChange={() => setProductType('other')} className="custom-radio hidden" />
                                    <div className="flex items-center justify-center gap-2 py-2 px-3 rounded-lg border border-slate-200 text-slate-500 transition-all hover:bg-slate-50">
                                        <div className="radio-dot w-3 h-3 rounded-full border border-slate-300"></div>
                                        <span className="text-sm font-bold">一般產品</span>
                                    </div>
                                </label>
                                <label className="flex-1 cursor-pointer">
                                    <input type="radio" checked={productType === 'lan'} onChange={() => setProductType('lan')} className="custom-radio hidden" />
                                    <div className="flex items-center justify-center gap-2 py-2 px-3 rounded-lg border border-slate-200 text-slate-500 transition-all hover:bg-slate-50">
                                        <div className="radio-dot w-3 h-3 rounded-full border border-slate-300"></div>
                                        <span className="text-sm font-bold">網通 (LAN)</span>
                                    </div>
                                </label>
                            </div>

                            <div className="flex justify-between items-center mb-1">
                                <h2 className="font-bold text-lg flex items-center gap-2 text-slate-800"><IconDollar /> 成本結構</h2>
                                <button onClick={handleReset} className="text-xs font-bold text-slate-400 flex items-center gap-1 bg-slate-100 px-2 py-1 rounded-md"><IconRefresh /> 重置</button>
                            </div>

                            {productType === 'other' && (
                                <div className="grid grid-cols-2 gap-2 mb-2">
                                    <button onClick={() => setCostCalcMode('direct')} className={`mode-btn py-2.5 rounded-lg font-bold text-sm border ${costCalcMode === 'direct' ? 'bg-indigo-600 border-indigo-600 text-white shadow-md' : 'bg-white border-slate-200 text-slate-400 hover:bg-slate-50'}`}>直接輸入</button>
                                    <button onClick={() => setCostCalcMode('detail')} className={`mode-btn py-2.5 rounded-lg font-bold text-sm border ${costCalcMode === 'detail' ? 'bg-indigo-600 border-indigo-600 text-white shadow-md' : 'bg-white border-slate-200 text-slate-400 hover:bg-slate-50'}`}><IconFactory className="inline mr-1"/> 詳細計算</button>
                                </div>
                            )}

                            {productType === 'other' && costCalcMode === 'detail' ? (
                                <div className="space-y-3 bg-indigo-50/60 p-4 rounded-2xl border border-indigo-100 animate-fade-in mb-4">
                                    <InputGroup label="材料費 (RMB)" value={detailMaterial} onChange={setDetailMaterial} prefix="¥" />
                                    <div className="grid grid-cols-2 gap-3">
                                        <InputGroup label="工時 (秒)" value={detailTime} onChange={setDetailTime} prefix="sec" className="shadow-none" />
                                        <InputGroup label="制工費 (¥/小時)" value={detailRate} onChange={setDetailRate} prefix="¥/hr" className="shadow-none" />
                                    </div>
                                    {isDetailFilled ? (
                                        <div className="pt-3 border-t border-indigo-200/50 space-y-2 animate-fade-in">
                                            <div className="flex justify-between items-center">
                                                <span className="text-xs font-bold text-indigo-700">計算總合 (RMB)</span>
                                                <span className="font-mono font-black text-indigo-600 text-xl">¥ {calcDetailRMB.toFixed(2)}</span>
                                            </div>
                                            <div className="grid grid-cols-2 gap-2">
                                                <div className="bg-white px-3 py-2 rounded-lg border border-indigo-100 text-center shadow-sm">
                                                    <span className="text-[9px] font-bold text-indigo-300 uppercase block">折合 USD</span>
                                                    <span className="font-mono font-bold text-slate-600">$ {calcDetailUSD.toFixed(2)}</span>
                                                </div>
                                                <div className="bg-white px-3 py-2 rounded-lg border border-indigo-100 text-center shadow-sm">
                                                    <span className="text-[9px] font-bold text-indigo-300 uppercase block">折合 TWD</span>
                                                    <span className="font-mono font-bold text-slate-600">$ {Math.round(calcDetailTWD)}</span>
                                                </div>
                                            </div>
                                            <div className="flex justify-end gap-1 bg-white/50 p-1 rounded-lg border border-indigo-100">
                                                <button onClick={() => setRmbTaxType('untaxed')} className={`flex-1 py-1 text-[10px] rounded-md font-bold transition-all ${rmbTaxType === 'untaxed' ? 'bg-indigo-600 text-white' : 'text-indigo-300'}`}>未稅</button>
                                                <button onClick={() => setRmbTaxType('taxed')} className={`flex-1 py-1 text-[10px] rounded-md font-bold transition-all ${rmbTaxType === 'taxed' ? 'bg-emerald-600 text-white' : 'text-indigo-300'}`}>含稅</button>
                                            </div>
                                        </div>
                                    ) : <p className="pt-3 text-center text-[10px] text-slate-400 font-bold italic">請完整填寫以上三欄以計算成本</p>}
                                </div>
                            ) : (
                                <>
                                    <InputGroup label="台幣成本 (TWD)" value={costTWD} onChange={setCostTWD} prefix="NT$" />
                                    <InputGroup label="美金成本 (USD)" value={costUSD} onChange={setCostUSD} prefix="US$" />
                                    <div className="h-px bg-slate-100 my-2"></div>
                                    <div className="space-y-1.5">
                                        <div className="flex justify-between items-center">
                                            <label className="text-xs font-bold text-slate-500 uppercase tracking-wider">人民幣成本 (RMB)</label>
                                            <div className="flex bg-slate-100 p-1 rounded-lg">
                                                <button onClick={() => setRmbTaxType('untaxed')} className={`px-3 py-1 text-[10px] rounded-md font-bold ${rmbTaxType === 'untaxed' ? 'bg-white shadow text-slate-800' : 'text-slate-400'}`}>未稅</button>
                                                <button onClick={() => setRmbTaxType('taxed')} className={`px-3 py-1 text-[10px] rounded-md font-bold ${rmbTaxType === 'taxed' ? 'bg-white shadow text-emerald-600' : 'text-slate-400'}`}>含稅</button>
                                            </div>
                                        </div>
                                        <div className="relative">
                                            <span className="absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 font-bold">¥</span>
                                            <input type="number" value={costRMB} onChange={(e) => setCostRMB(e.target.value)} className="w-full pl-14 pr-3 py-2.5 bg-white border border-slate-200 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none font-bold text-slate-700 text-lg shadow-sm" placeholder="0.00" />
                                        </div>
                                    </div>
                                </>
                            )}
                        </Card>

                        {/* Results */}
                        <div className="space-y-4 pb-10">
                            {totalCostTWD > 0 ? (
                                <div className="space-y-4 animate-fade-in">
                                    <div className={`flex justify-between items-center px-2 text-white p-4 rounded-xl shadow-lg transition-colors ${productType === 'lan' ? 'bg-sky-600' : 'bg-slate-800'}`}>
                                        <span className="font-bold text-sm opacity-80">總成本 (USD)</span>
                                        <span className="text-2xl font-mono font-bold tracking-tight">$ {(totalCostTWD / rateUSD).toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}</span>
                                    </div>
                                    <Card className="p-4 border-2 border-emerald-100 bg-emerald-50/30">
                                        <div className="flex gap-2 mb-3">
                                            <input type="number" value={customPrice} onChange={(e) => setCustomPrice(e.target.value)} className="flex-1 pl-3 pr-3 py-3 border border-emerald-200 rounded-lg outline-none font-bold text-lg" placeholder="自訂報價反算" />
                                            <select value={customCurrency} onChange={(e) => setCustomCurrency(e.target.value)} className="px-2 py-2 border border-emerald-200 rounded-lg bg-white font-bold text-sm">
                                                <option value="USD">USD</option><option value="RMB">RMB</option><option value="TWD">TWD</option>
                                            </select>
                                        </div>
                                        {customResult ? (
                                            <div className="bg-white rounded-lg p-3 border border-emerald-100 grid grid-cols-2 gap-4 shadow-sm">
                                                <div><div className="text-[10px] text-slate-400 font-bold">預估毛利率</div><div className={`font-black text-xl ${customResult.margin < 0 ? 'text-red-500' : 'text-emerald-600'}`}>{customResult.margin.toFixed(2)}%</div></div>
                                                <div><div className="text-[10px] text-slate-400 font-bold">預估淨利 (TWD)</div><div className={`font-mono font-bold text-sm ${customResult.profit < 0 ? 'text-red-500' : 'text-slate-700'}`}>NT$ {fmt(customResult.profit)}</div></div>
                                            </div>
                                        ) : <p className="text-[10px] text-slate-400 text-center italic">輸入價格以反算毛利</p>}
                                    </Card>
                                    <div className="space-y-3">
                                        <div className={`flex items-center gap-2 mb-1 px-1 ${productType === 'lan' ? 'text-sky-600' : 'text-indigo-600'}`}>
                                            <IconTrending /><span className="text-xs font-black uppercase tracking-widest">{productType === 'lan' ? 'LAN 網通建議報價 (20%起)' : '一般建議報價 (33%起)'}</span>
                                        </div>
                                        {calculations && (
                                            <>
                                                <ResultRow label={calculations.low.label} twd={`NT$ ${fmt(calculations.low.twd)}`} usd={`$ ${calculations.low.usd}`} rmb={`¥ ${calculations.low.rmb}`} />
                                                <ResultRow label={calculations.mid.label} twd={`NT$ ${fmt(calculations.mid.twd)}`} usd={`$ ${calculations.mid.usd}`} rmb={`¥ ${calculations.mid.rmb}`} highlight={true} />
                                                <ResultRow label={calculations.high.label} twd={`NT$ ${fmt(calculations.high.twd)}`} usd={`$ ${calculations.high.usd}`} rmb={`¥ ${calculations.high.rmb}`} />
                                            </>
                                        )}
                                    </div>
                                    <div className="flex gap-2 p-3 bg-blue-50 text-blue-700 text-[10px] rounded-lg font-medium">
                                        <IconInfo /><p>台幣報價含5%稅。建議報價基於 USD 並使用交叉匯率換算 RMB。</p>
                                    </div>
                                </div>
                            ) : <div className="py-12 text-center text-slate-300 font-bold tracking-widest">等待輸入完整成本數據...</div>}
                        </div>
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
